#!/bin/bash

# Include functions
CURRENT_DIR=$(dirname $BASH_SOURCE)/;
source $CURRENT_DIR/functions;

# Init vars
TELELAB_PATH=$(dirname CURRENT_DIR)/;
APP_PATH=$TELELAB_PATH"app/";

# Create files configuration
show_action "Création des fichiers de configuration";
cp -v $APP_PATH"etc/"{_,}app.php;
cp -v $APP_PATH"etc/"{_,}routing.php;

# Create log directory
create_dir $TELELAB_PATH"var/log";
chmod 777 $TELELAB_PATH"var/log";

show_action "Installation des librairies externe";
curl -sS https://getcomposer.org/installer | php -- --install-dir=bin
$TELELAB_PATH/bin/composer.phar install

show_action "Création d'une application";
echo -n "Nom de l'application: ";
read app;

if test "$app" = ""
then
    app="Basic";
fi

$CURRENT_DIR"create_app" $app;

show_action "Configuration du routage applicatif";
echo $APP_PATH$app"/etc/routing.php";
sed -i s/{{app_name}}/$app/g $APP_PATH"/etc/routing.php";

show_action "Configuration du serveur http";
echo "* Voir le fichier $APP_PATH"etc/"apache_configuration";
echo "* Remplacer HOSTNAME par votre nom de domaine";
echo "* Remplacer APP_NAME par le nom de votre application";
echo "* Remplacer DOCUMENT_ROOT par la racine du framework";
